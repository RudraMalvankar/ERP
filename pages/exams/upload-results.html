<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Results - SmartERP</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="navbar-brand">
                <i class="fas fa-graduation-cap text-primary"></i>
                SmartERP
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <ul>
                <li class="sidebar-nav-item">
                    <a href="../admin-dashboard.html" class="sidebar-nav-link">
                        <i class="sidebar-nav-icon fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="hall-ticket.html" class="sidebar-nav-link">
                        <i class="sidebar-nav-icon fas fa-id-card"></i>
                        Hall Tickets
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="register.html" class="sidebar-nav-link">
                        <i class="sidebar-nav-icon fas fa-clipboard-list"></i>
                        Exam Registration
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="results.html" class="sidebar-nav-link">
                        <i class="sidebar-nav-icon fas fa-chart-line"></i>
                        View Results
                    </a>
                </li>
                <li class="sidebar-nav-item">
                    <a href="upload-results.html" class="sidebar-nav-link active">
                        <i class="sidebar-nav-icon fas fa-upload"></i>
                        Upload Results
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navigation -->
        <div class="top-nav">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <button class="mobile-menu-btn">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div>
                        <h1 class="page-title">Upload Examination Results</h1>
                        <nav class="breadcrumb">
                            <a href="../admin-dashboard.html">Dashboard</a>
                            <span>/</span>
                            <span>Upload Results</span>
                        </nav>
                    </div>
                </div>
                
                <div class="flex items-center gap-4">
                    <!-- Notification Badge -->
                    <div class="notification-badge">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    
                    <!-- User Menu -->
                    <div class="user-menu">
                        <button class="user-menu-toggle">
                            <img src="../../assets/images/admin-avatar.jpg" alt="Admin" class="user-avatar-small" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM2MzY2ZjEiLz48L3N2Zz4='">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div class="user-menu-dropdown">
                            <div class="user-menu-header">
                                <div class="user-name">Dr. Sarah Johnson</div>
                                <div class="user-email">admin@college.edu</div>
                            </div>
                            <div class="user-menu-items">
                                <a href="#" class="user-menu-item logout-btn">
                                    <i class="fas fa-sign-out-alt"></i>
                                    Logout
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content -->
        <div class="content-wrapper">
            <!-- Quick Actions -->
            <div class="quick-actions">
                <button class="action-btn primary" onclick="openBulkUpload()">
                    <i class="fas fa-file-upload"></i>
                    Bulk Upload Results
                </button>
                <button class="action-btn secondary" onclick="openIndividualEntry()">
                    <i class="fas fa-keyboard"></i>
                    Manual Entry
                </button>
                <button class="action-btn outline" onclick="downloadTemplate()">
                    <i class="fas fa-download"></i>
                    Download Template
                </button>
                <button class="action-btn outline" onclick="viewUploadHistory()">
                    <i class="fas fa-history"></i>
                    Upload History
                </button>
            </div>

            <!-- Upload Options -->
            <div class="upload-options">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Select Exam Details</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="academicYear">Academic Year</label>
                                <select class="form-select" id="academicYear" onchange="loadSemesters()">
                                    <option value="">Select Academic Year</option>
                                    <option value="2024-25" selected>2024-25</option>
                                    <option value="2023-24">2023-24</option>
                                    <option value="2022-23">2022-23</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="semester">Semester</label>
                                <select class="form-select" id="semester" onchange="loadSubjects()">
                                    <option value="">Select Semester</option>
                                    <option value="1" selected>Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="department">Department</label>
                                <select class="form-select" id="department" onchange="loadSubjects()">
                                    <option value="">Select Department</option>
                                    <option value="cse" selected>Computer Science Engineering</option>
                                    <option value="ece">Electronics & Communication</option>
                                    <option value="me">Mechanical Engineering</option>
                                    <option value="ce">Civil Engineering</option>
                                    <option value="ee">Electrical Engineering</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="examType">Exam Type</label>
                                <select class="form-select" id="examType">
                                    <option value="">Select Exam Type</option>
                                    <option value="mid" selected>Mid Semester</option>
                                    <option value="end">End Semester</option>
                                    <option value="internal">Internal Assessment</option>
                                    <option value="practical">Practical Exam</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Upload Methods -->
            <div class="upload-methods">
                <!-- Bulk Upload -->
                <div class="upload-method" id="bulkUploadMethod">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-file-excel text-success"></i>
                                Bulk Upload Results
                            </h3>
                            <div class="upload-status" id="uploadStatus"></div>
                        </div>
                        <div class="card-body">
                            <div class="upload-zone" id="uploadZone">
                                <div class="upload-placeholder">
                                    <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                                    <h4>Drag & Drop Excel File Here</h4>
                                    <p>or click to browse files</p>
                                    <p class="text-sm text-secondary">Supported formats: .xlsx, .xls (Max: 10MB)</p>
                                    <input type="file" id="resultFile" accept=".xlsx,.xls" hidden>
                                    <button class="btn btn-primary mt-3" onclick="document.getElementById('resultFile').click()">
                                        Choose File
                                    </button>
                                </div>
                            </div>
                            
                            <div class="upload-progress" id="uploadProgress" style="display: none;">
                                <div class="progress-info">
                                    <span class="progress-text">Uploading results...</span>
                                    <span class="progress-percentage">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFill"></div>
                                </div>
                            </div>
                            
                            <div class="upload-actions mt-4" id="uploadActions" style="display: none;">
                                <button class="btn btn-success" onclick="processResults()">
                                    <i class="fas fa-check"></i>
                                    Process Results
                                </button>
                                <button class="btn btn-outline" onclick="validateResults()">
                                    <i class="fas fa-check-circle"></i>
                                    Validate Data
                                </button>
                                <button class="btn btn-danger" onclick="cancelUpload()">
                                    <i class="fas fa-times"></i>
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manual Entry -->
                <div class="upload-method" id="manualEntryMethod" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-keyboard text-primary"></i>
                                Manual Result Entry
                            </h3>
                            <div class="entry-controls">
                                <button class="btn btn-sm btn-primary" onclick="addStudentRow()">
                                    <i class="fas fa-plus"></i>
                                    Add Student
                                </button>
                                <button class="btn btn-sm btn-outline" onclick="clearAllEntries()">
                                    <i class="fas fa-trash"></i>
                                    Clear All
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="subject-selection">
                                <div class="form-group">
                                    <label for="subjectCode">Subject</label>
                                    <select class="form-select" id="subjectCode" onchange="loadStudentList()">
                                        <option value="">Select Subject</option>
                                        <option value="CS101">CS101 - Programming Fundamentals</option>
                                        <option value="MA101">MA101 - Engineering Mathematics I</option>
                                        <option value="PH101">PH101 - Engineering Physics I</option>
                                        <option value="CH101">CH101 - Engineering Chemistry</option>
                                        <option value="EG101">EG101 - Engineering Graphics</option>
                                        <option value="EN101">EN101 - English Communication</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="manual-entry-table">
                                <table class="data-table" id="entryTable">
                                    <thead>
                                        <tr>
                                            <th>Roll Number</th>
                                            <th>Student Name</th>
                                            <th>Internal Marks (40)</th>
                                            <th>External Marks (60)</th>
                                            <th>Total Marks (100)</th>
                                            <th>Grade</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="entryTableBody">
                                        <tr>
                                            <td colspan="7" class="text-center text-secondary">
                                                Select a subject to load student list
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="entry-actions mt-4">
                                <button class="btn btn-success" onclick="saveResults()">
                                    <i class="fas fa-save"></i>
                                    Save Results
                                </button>
                                <button class="btn btn-outline" onclick="previewResults()">
                                    <i class="fas fa-eye"></i>
                                    Preview
                                </button>
                                <button class="btn btn-secondary" onclick="saveDraft()">
                                    <i class="fas fa-file-alt"></i>
                                    Save as Draft
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Uploads -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Result Uploads</h3>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-outline" onclick="refreshUploads()">
                            <i class="fas fa-sync"></i>
                            Refresh
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="upload-history">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Exam Details</th>
                                    <th>Subject</th>
                                    <th>Students</th>
                                    <th>Upload Method</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="datetime-info">
                                            <div class="date">Jan 15, 2025</div>
                                            <div class="time">2:30 PM</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="exam-info">
                                            <div class="exam-title">Semester 1 - Mid Exam</div>
                                            <div class="exam-meta">CSE Department</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="subject-info">
                                            <div class="subject-code">CS101</div>
                                            <div class="subject-name">Programming Fundamentals</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="student-count">
                                            <span class="count">120</span>
                                            <span class="label">students</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="upload-method-badge bulk">
                                            <i class="fas fa-file-excel"></i>
                                            Bulk Upload
                                        </span>
                                    </td>
                                    <td>
                                        <span class="status-badge success">
                                            <i class="fas fa-check-circle"></i>
                                            Completed
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-outline" onclick="viewUploadDetails('upload1')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline" onclick="downloadResults('upload1')">
                                                <i class="fas fa-download"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteUpload('upload1')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="datetime-info">
                                            <div class="date">Jan 12, 2025</div>
                                            <div class="time">4:45 PM</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="exam-info">
                                            <div class="exam-title">Semester 1 - Internal</div>
                                            <div class="exam-meta">CSE Department</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="subject-info">
                                            <div class="subject-code">MA101</div>
                                            <div class="subject-name">Engineering Mathematics I</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="student-count">
                                            <span class="count">118</span>
                                            <span class="label">students</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="upload-method-badge manual">
                                            <i class="fas fa-keyboard"></i>
                                            Manual Entry
                                        </span>
                                    </td>
                                    <td>
                                        <span class="status-badge warning">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Pending Review
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-outline" onclick="viewUploadDetails('upload2')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-primary" onclick="reviewResults('upload2')">
                                                <i class="fas fa-check"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteUpload('upload2')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="datetime-info">
                                            <div class="date">Jan 10, 2025</div>
                                            <div class="time">1:15 PM</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="exam-info">
                                            <div class="exam-title">Semester 1 - Practical</div>
                                            <div class="exam-meta">CSE Department</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="subject-info">
                                            <div class="subject-code">CS101L</div>
                                            <div class="subject-name">Programming Lab</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="student-count">
                                            <span class="count">120</span>
                                            <span class="label">students</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="upload-method-badge bulk">
                                            <i class="fas fa-file-excel"></i>
                                            Bulk Upload
                                        </span>
                                    </td>
                                    <td>
                                        <span class="status-badge error">
                                            <i class="fas fa-times-circle"></i>
                                            Failed
                                        </span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="btn btn-sm btn-outline" onclick="viewUploadDetails('upload3')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-sm btn-warning" onclick="retryUpload('upload3')">
                                                <i class="fas fa-redo"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteUpload('upload3')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Template Modal -->
    <div class="modal" id="templateModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Download Result Template</h3>
                    <button class="modal-close" onclick="closeModal('templateModal')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="template-options">
                        <div class="template-option" onclick="downloadTemplate('theory')">
                            <div class="template-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="template-info">
                                <h4>Theory Exam Template</h4>
                                <p>For theory subjects with internal and external marks</p>
                            </div>
                        </div>
                        
                        <div class="template-option" onclick="downloadTemplate('practical')">
                            <div class="template-icon">
                                <i class="fas fa-flask"></i>
                            </div>
                            <div class="template-info">
                                <h4>Practical Exam Template</h4>
                                <p>For practical/lab subjects</p>
                            </div>
                        </div>
                        
                        <div class="template-option" onclick="downloadTemplate('internal')">
                            <div class="template-icon">
                                <i class="fas fa-clipboard-check"></i>
                            </div>
                            <div class="template-info">
                                <h4>Internal Assessment Template</h4>
                                <p>For continuous assessment marks</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../assets/js/storage.js"></script>
    <script src="../../assets/js/fake-data.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/main.js"></script>
    
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            initializeUploadZone();
        });

        // Setup event listeners
        function setupEventListeners() {
            // User menu toggle
            document.querySelector('.user-menu-toggle').addEventListener('click', function(e) {
                e.stopPropagation();
                document.querySelector('.user-menu-dropdown').classList.toggle('show');
            });

            // File input change
            document.getElementById('resultFile').addEventListener('change', handleFileSelect);

            // Close dropdowns when clicking outside
            document.addEventListener('click', function() {
                document.querySelectorAll('.dropdown, .user-menu-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            });
        }

        // Initialize upload zone
        function initializeUploadZone() {
            const uploadZone = document.getElementById('uploadZone');
            
            // Drag and drop events
            uploadZone.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadZone.classList.add('drag-over');
            });
            
            uploadZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadZone.classList.remove('drag-over');
            });
            
            uploadZone.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadZone.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        // Quick action functions
        function openBulkUpload() {
            document.getElementById('bulkUploadMethod').style.display = 'block';
            document.getElementById('manualEntryMethod').style.display = 'none';
            
            // Update active state
            document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function openIndividualEntry() {
            document.getElementById('bulkUploadMethod').style.display = 'none';
            document.getElementById('manualEntryMethod').style.display = 'block';
            
            // Update active state
            document.querySelectorAll('.action-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function downloadTemplate() {
            openModal('templateModal');
        }

        function viewUploadHistory() {
            showNotification('Loading upload history...', 'info');
        }

        // File handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Validate file
            if (!validateFile(file)) {
                return;
            }

            // Show file info
            showFileInfo(file);
            
            // Simulate file upload
            simulateUpload();
        }

        function validateFile(file) {
            const allowedTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];
            const maxSize = 10 * 1024 * 1024; // 10MB

            if (!allowedTypes.includes(file.type)) {
                showNotification('Please select a valid Excel file (.xlsx or .xls)', 'error');
                return false;
            }

            if (file.size > maxSize) {
                showNotification('File size must be less than 10MB', 'error');
                return false;
            }

            return true;
        }

        function showFileInfo(file) {
            const uploadZone = document.getElementById('uploadZone');
            uploadZone.innerHTML = `
                <div class="file-info">
                    <div class="file-icon">
                        <i class="fas fa-file-excel text-success fa-2x"></i>
                    </div>
                    <div class="file-details">
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <button class="btn btn-sm btn-outline" onclick="removeFile()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
        }

        function removeFile() {
            document.getElementById('resultFile').value = '';
            resetUploadZone();
        }

        function resetUploadZone() {
            const uploadZone = document.getElementById('uploadZone');
            uploadZone.innerHTML = `
                <div class="upload-placeholder">
                    <i class="fas fa-cloud-upload-alt fa-3x text-primary mb-3"></i>
                    <h4>Drag & Drop Excel File Here</h4>
                    <p>or click to browse files</p>
                    <p class="text-sm text-secondary">Supported formats: .xlsx, .xls (Max: 10MB)</p>
                    <button class="btn btn-primary mt-3" onclick="document.getElementById('resultFile').click()">
                        Choose File
                    </button>
                </div>
            `;
        }

        function simulateUpload() {
            const progressContainer = document.getElementById('uploadProgress');
            const actionsContainer = document.getElementById('uploadActions');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.querySelector('.progress-percentage');
            
            progressContainer.style.display = 'block';
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress > 100) progress = 100;
                
                progressFill.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        actionsContainer.style.display = 'block';
                        showNotification('File uploaded successfully! Please validate the data.', 'success');
                    }, 500);
                }
            }, 200);
        }

        // Form functions
        function loadSemesters() {
            const year = document.getElementById('academicYear').value;
            if (year) {
                showNotification('Loading semesters for ' + year, 'info');
            }
        }

        function loadSubjects() {
            const semester = document.getElementById('semester').value;
            const department = document.getElementById('department').value;
            
            if (semester && department) {
                showNotification('Loading subjects...', 'info');
            }
        }

        function loadStudentList() {
            const subjectCode = document.getElementById('subjectCode').value;
            if (!subjectCode) return;

            const tableBody = document.getElementById('entryTableBody');
            const students = [
                { roll: 'CS21001', name: 'John Smith' },
                { roll: 'CS21002', name: 'Jane Doe' },
                { roll: 'CS21003', name: 'Mike Johnson' },
                { roll: 'CS21004', name: 'Sarah Wilson' },
                { roll: 'CS21005', name: 'David Brown' }
            ];

            tableBody.innerHTML = students.map(student => `
                <tr>
                    <td class="roll-number">${student.roll}</td>
                    <td class="student-name">${student.name}</td>
                    <td>
                        <input type="number" class="form-input" min="0" max="40" 
                               onchange="calculateTotal(this)" placeholder="0">
                    </td>
                    <td>
                        <input type="number" class="form-input" min="0" max="60" 
                               onchange="calculateTotal(this)" placeholder="0">
                    </td>
                    <td class="total-marks">0</td>
                    <td class="grade">-</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="removeStudentRow(this)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function calculateTotal(input) {
            const row = input.closest('tr');
            const internalInput = row.cells[2].querySelector('input');
            const externalInput = row.cells[3].querySelector('input');
            const totalCell = row.cells[4];
            const gradeCell = row.cells[5];

            const internal = parseFloat(internalInput.value) || 0;
            const external = parseFloat(externalInput.value) || 0;
            const total = internal + external;

            totalCell.textContent = total;
            gradeCell.textContent = calculateGrade(total);
        }

        function calculateGrade(marks) {
            if (marks >= 90) return 'A+';
            if (marks >= 80) return 'A';
            if (marks >= 70) return 'B+';
            if (marks >= 60) return 'B';
            if (marks >= 50) return 'C';
            if (marks >= 40) return 'D';
            return 'F';
        }

        function addStudentRow() {
            const tableBody = document.getElementById('entryTableBody');
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>
                    <input type="text" class="form-input" placeholder="Roll Number">
                </td>
                <td>
                    <input type="text" class="form-input" placeholder="Student Name">
                </td>
                <td>
                    <input type="number" class="form-input" min="0" max="40" 
                           onchange="calculateTotal(this)" placeholder="0">
                </td>
                <td>
                    <input type="number" class="form-input" min="0" max="60" 
                           onchange="calculateTotal(this)" placeholder="0">
                </td>
                <td class="total-marks">0</td>
                <td class="grade">-</td>
                <td>
                    <button class="btn btn-sm btn-danger" onclick="removeStudentRow(this)">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            tableBody.appendChild(newRow);
        }

        function removeStudentRow(button) {
            button.closest('tr').remove();
        }

        function clearAllEntries() {
            if (confirm('Are you sure you want to clear all entries?')) {
                document.getElementById('entryTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-secondary">
                            Select a subject to load student list
                        </td>
                    </tr>
                `;
                document.getElementById('subjectCode').value = '';
            }
        }

        // Action functions
        function processResults() {
            showNotification('Processing results...', 'info');
            setTimeout(() => {
                showNotification('Results processed successfully!', 'success');
                resetUpload();
            }, 2000);
        }

        function validateResults() {
            showNotification('Validating data...', 'info');
            setTimeout(() => {
                showNotification('Data validation completed. No errors found.', 'success');
            }, 1500);
        }

        function cancelUpload() {
            if (confirm('Are you sure you want to cancel the upload?')) {
                resetUpload();
            }
        }

        function resetUpload() {
            document.getElementById('uploadProgress').style.display = 'none';
            document.getElementById('uploadActions').style.display = 'none';
            resetUploadZone();
        }

        function saveResults() {
            showNotification('Saving results...', 'info');
            setTimeout(() => {
                showNotification('Results saved successfully!', 'success');
            }, 2000);
        }

        function previewResults() {
            showNotification('Opening results preview...', 'info');
        }

        function saveDraft() {
            showNotification('Draft saved successfully!', 'success');
        }

        // History functions
        function refreshUploads() {
            showNotification('Refreshing upload history...', 'info');
        }

        function viewUploadDetails(uploadId) {
            showNotification('Loading upload details...', 'info');
        }

        function downloadResults(uploadId) {
            showNotification('Downloading results...', 'info');
        }

        function deleteUpload(uploadId) {
            if (confirm('Are you sure you want to delete this upload?')) {
                showNotification('Upload deleted successfully!', 'success');
            }
        }

        function reviewResults(uploadId) {
            showNotification('Opening results for review...', 'info');
        }

        function retryUpload(uploadId) {
            showNotification('Retrying upload...', 'info');
        }

        // Template functions
        function downloadTemplate(type) {
            showNotification(`Downloading ${type} template...`, 'info');
            closeModal('templateModal');
            setTimeout(() => {
                showNotification('Template downloaded successfully!', 'success');
            }, 1000);
        }

        // Utility functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
    </script>

    <style>
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .breadcrumb a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .quick-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            text-decoration: none;
        }

        .action-btn.primary {
            background: var(--primary-color);
            color: white;
        }

        .action-btn.primary:hover {
            background: var(--primary-hover);
        }

        .action-btn.secondary {
            background: var(--secondary-color);
            color: white;
        }

        .action-btn.outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .action-btn.outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .action-btn.active {
            background: var(--primary-color);
            color: white;
        }

        .upload-options {
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .upload-methods {
            margin-bottom: 2rem;
        }

        .upload-method {
            margin-bottom: 2rem;
        }

        .upload-zone {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 3rem 2rem;
            text-align: center;
            background: #f9fafb;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }

        .upload-zone.drag-over {
            border-color: var(--primary-color);
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .upload-placeholder h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }

        .upload-placeholder p {
            margin: 0.25rem 0;
            color: var(--text-secondary);
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            border: 2px solid var(--success-color);
        }

        .file-icon {
            flex-shrink: 0;
        }

        .file-details {
            flex: 1;
            text-align: left;
        }

        .file-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .file-size {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .upload-progress {
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-text {
            font-weight: 500;
            color: var(--text-primary);
        }

        .progress-percentage {
            font-weight: 600;
            color: var(--primary-color);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-hover));
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .upload-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .upload-status {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .entry-controls {
            display: flex;
            gap: 0.5rem;
        }

        .subject-selection {
            margin-bottom: 2rem;
        }

        .manual-entry-table {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .data-table td {
            font-size: 0.875rem;
        }

        .data-table input {
            width: 100%;
            max-width: 100px;
        }

        .roll-number {
            font-weight: 600;
            color: var(--primary-color);
        }

        .student-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .total-marks {
            font-weight: 600;
            color: var(--text-primary);
        }

        .grade {
            font-weight: 600;
            text-align: center;
        }

        .entry-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .upload-history {
            overflow-x: auto;
        }

        .datetime-info {
            text-align: left;
        }

        .date {
            font-weight: 500;
            color: var(--text-primary);
        }

        .time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .exam-info {
            text-align: left;
        }

        .exam-title {
            font-weight: 500;
            color: var(--text-primary);
        }

        .exam-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .subject-info {
            text-align: left;
        }

        .subject-code {
            font-weight: 600;
            color: var(--primary-color);
        }

        .subject-name {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .student-count {
            text-align: center;
        }

        .count {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
        }

        .label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .upload-method-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .upload-method-badge.bulk {
            background: #dcfce7;
            color: #166534;
        }

        .upload-method-badge.manual {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-badge.success {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-buttons {
            display: flex;
            gap: 0.25rem;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .notification-badge {
            position: relative;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            background: #f3f4f6;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }

        .notification-badge:hover {
            background: #e5e7eb;
            color: var(--text-primary);
        }

        .notification-badge .badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger-color);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.125rem 0.375rem;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-dialog {
            background: white;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .modal-title {
            margin: 0;
            color: var(--text-primary);
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .template-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .template-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .template-option:hover {
            border-color: var(--primary-color);
            background: #f0f4ff;
        }

        .template-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .template-info h4 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
            font-weight: 600;
        }

        .template-info p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .notification-content {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notification-success {
            background: var(--success-color);
        }

        .notification-error {
            background: var(--danger-color);
        }

        .notification-info {
            background: var(--primary-color);
        }

        @media (max-width: 768px) {
            .quick-actions {
                flex-direction: column;
            }
            
            .action-btn {
                justify-content: center;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .upload-actions,
            .entry-actions {
                flex-direction: column;
            }
            
            .data-table {
                font-size: 0.75rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 8px 4px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .modal-dialog {
                width: 95%;
            }
        }
    </style>
</body>
</html>
